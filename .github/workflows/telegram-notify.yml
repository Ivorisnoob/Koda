name: Telegram Notifications

on:
  push:
    branches: [main, master]
  pull_request:
    types: [opened, closed, reopened]
  issues:
    types: [opened, closed, reopened]
  issue_comment:
    types: [created]
  watch:
    types: [started]  # Stars
  fork:
  release:
    types: [published]

env:
  TELEGRAM_CHAT_ID: "@ivorisnoob_projects"

jobs:
  # Push/Commit Notification
  notify-push:
    if: github.event_name == 'push'
    runs-on: ubuntu-latest
    steps:
      - name: Send Push Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${{ env.TELEGRAM_CHAT_ID }}" \
            -d "parse_mode=HTML" \
            -d "text=<b>The Music App</b> | New Update

          New commit pushed!

          Repo: <code>${{ github.repository }}</code>
          Branch: <code>${{ github.ref_name }}</code>
          Author: <b>${{ github.event.head_commit.author.name }}</b>

          <a href='${{ github.event.head_commit.url }}'>View Changes</a>"

  # Pull Request Opened
  notify-pr-opened:
    if: github.event_name == 'pull_request' && github.event.action == 'opened'
    runs-on: ubuntu-latest
    steps:
      - name: Send PR Opened Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${{ env.TELEGRAM_CHAT_ID }}" \
            -d "parse_mode=HTML" \
            -d "text=<b>The Music App</b> | Pull Request

          New PR opened!

          Title: <b>${{ github.event.pull_request.title }}</b>
          Author: <b>${{ github.event.pull_request.user.login }}</b>

          <a href='${{ github.event.pull_request.html_url }}'>View PR</a>"

  # Pull Request Merged
  notify-pr-merged:
    if: github.event_name == 'pull_request' && github.event.action == 'closed' && github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Send PR Merged Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${{ env.TELEGRAM_CHAT_ID }}" \
            -d "parse_mode=HTML" \
            -d "text=<b>The Music App</b> | Merged!

          PR successfully merged!

          Title: <b>${{ github.event.pull_request.title }}</b>
          Merged by: <b>${{ github.event.sender.login }}</b>

          <a href='${{ github.event.pull_request.html_url }}'>View Details</a>"

  # Issue Opened
  notify-issue-opened:
    if: github.event_name == 'issues' && github.event.action == 'opened'
    runs-on: ubuntu-latest
    steps:
      - name: Send Issue Opened Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${{ env.TELEGRAM_CHAT_ID }}" \
            -d "parse_mode=HTML" \
            -d "text=<b>The Music App</b> | New Issue

          Issue reported!

          Title: <b>${{ github.event.issue.title }}</b>
          Reported by: <b>${{ github.event.issue.user.login }}</b>

          <a href='${{ github.event.issue.html_url }}'>View Issue</a>"

  # Issue Closed
  notify-issue-closed:
    if: github.event_name == 'issues' && github.event.action == 'closed'
    runs-on: ubuntu-latest
    steps:
      - name: Send Issue Closed Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${{ env.TELEGRAM_CHAT_ID }}" \
            -d "parse_mode=HTML" \
            -d "text=<b>The Music App</b> | Issue Resolved

          Issue closed!

          Title: <b>${{ github.event.issue.title }}</b>
          Closed by: <b>${{ github.event.sender.login }}</b>

          <a href='${{ github.event.issue.html_url }}'>View Issue</a>"

  # Issue Comment
  notify-comment:
    if: github.event_name == 'issue_comment'
    runs-on: ubuntu-latest
    steps:
      - name: Send Comment Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${{ env.TELEGRAM_CHAT_ID }}" \
            -d "parse_mode=HTML" \
            -d "text=<b>The Music App</b> | New Comment

          Someone commented!

          On: <b>${{ github.event.issue.title }}</b>
          By: <b>${{ github.event.comment.user.login }}</b>

          <a href='${{ github.event.comment.html_url }}'>Read Comment</a>"

  # Star
  notify-star:
    if: github.event_name == 'watch' && github.event.action == 'started'
    runs-on: ubuntu-latest
    steps:
      - name: Send Star Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${{ env.TELEGRAM_CHAT_ID }}" \
            -d "parse_mode=HTML" \
            -d "text=<b>The Music App</b> | New Star!

          We got a new star!

          <b>${{ github.event.sender.login }}</b> starred the repo!
          Total Stars: <b>${{ github.event.repository.stargazers_count }}</b>

          Thank you for your support!
          <a href='https://github.com/${{ github.repository }}'>Visit Repo</a>"

  # Fork
  notify-fork:
    if: github.event_name == 'fork'
    runs-on: ubuntu-latest
    steps:
      - name: Send Fork Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${{ env.TELEGRAM_CHAT_ID }}" \
            -d "parse_mode=HTML" \
            -d "text=<b>The Music App</b> | Forked!

          Repository forked!

          <b>${{ github.event.sender.login }}</b> forked the project!
          Fork: <code>${{ github.event.forkee.full_name }}</code>

          Happy coding!
          <a href='${{ github.event.forkee.html_url }}'>View Fork</a>"

  # Release
  notify-release:
    if: github.event_name == 'release'
    runs-on: ubuntu-latest
    steps:
      - name: Send Release Notification
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        run: |
          curl -s -X POST "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -d "chat_id=${{ env.TELEGRAM_CHAT_ID }}" \
            -d "parse_mode=HTML" \
            -d "text=<b>The Music App</b> | New Release!

          Version <b>${{ github.event.release.tag_name }}</b>

          Name: <b>${{ github.event.release.name }}</b>
          Author: <b>${{ github.event.release.author.login }}</b>

          <a href='${{ github.event.release.html_url }}'>Download Now</a>"
